<!-- saved from url=(0024)http://www.marteens.com/ -->
<HTML>
<HEAD>
  <TITLE>XSight Ray Tracer: Samplers</TITLE>
  <meta name="save" content="history" />
  <LINK REL="stylesheet" HREF="xsighthelp.css" TYPE="text/css">
  <script src="xshelp.js"></script>
</HEAD>
<BODY>

<div id="HDR">
  XSight RT
  <h1>Small Instantiation Language: Samplers</h1>
  <a href="#see">See also</a>
</div>

<div id="MAIN">

<div id="allHistory" class="saveHistory" onsave="saveAll()" onload="loadAll()">
</div>

<p>Each scene in XSight RT must supply a <i>sampler</i>. The <i>sampler</i> is responsible of sending visual rays to the scene through the lens of the camera. Depending on the kind of sampler, it may send one or more rays for each pixel. That's because several rays by pixel are required to achieve antialiasing, focal blur and other effects. These are the samplers supported in this version:</p>

<ul type="square">
  <li><a href="#basic">BasicSampler</a></li>
  <li><a href="#super">SuperSampler</a></li>
  <li><a href="#antialias">AntialiasSampler</a></li>
  <li><a href="#adaptive">AdaptiveSampler</a></li>
  <li><a href="#focal">FocalSampler</a></li>
</ul>

<p align=justify>There are two additional samplers: the <a href="#draft">draft sampler</a> and the <a href="#draft">sonar sampler</a>. These are special purpose samplers that cannot be directly instantiated from a scene script.</p>

<a name="basic"></a><h2>Basic sampler</h2>

<p align="justify">The <b>basic sampler</b> is the simplest. It only traces a ray for each pixel in the final image. It trades speed for quality. As the following image shows, object borders are jagged.</p>

<dir><img src="samp00.png" border="0" /></dir>

<p align=justify>There are three ways to create a basic sampler:</p>

<ul type=square>
  <li class=code>BasicSampler(bounces, minimumWeight)</li>
  <li class=code>BasicSampler(bounces)</li>
  <li class=code>BasicSampler</li>
</ul>

<p align=justify>The <i>bounces</i> parameter controls the maximum numbers of reflections and refractions for a single light ray before stopping the trace. The default value is <i>10</i>. You should rise this value if your scene contains a lot of reflecting or transparent objects.</p>

<p align=justify>With each successive reflections or refractions, the intensity of a light ray diminishes. The <i>minimumWeight</i> parameters controls the lower intensity limit allowed for a light ray before halting the trace. Default value: <i>0.001</i>.</p>

<a name="super"></a><h2>Super sampler</h2>

<p align=justify>The <b>super sampler</b> sacrifices some speed to smooth jagged edges. It starts rendering the same way as the basic sampler. However,  the sampler checks the color difference between each traced pixel and its immediate neighbors. If the difference is higher than a threshold, the sampler traces four more points around the conflictive pixel. These additional points are shared by neighbors so, even in the worst case, you only need to render twice the number of pixels in the final image.</p>

<dir><img src="samp01.png" border="0" /></dir>

<ul type=square>
  <li class=code>SuperSampler(bounces, minimumWeight, threshold)</li>
  <li class=code>SuperSampler(bounces, minimumWeight)</li>
</ul>

<p align=justify>The threshold parameter is an integer value, and its default value is <i>16</i>. The difference between the colors of two adjacent pixels is measured using a weighted version of the so called <i>Manhattan metric</i>.</p>

<a name="antialias"></a><h2>Antialias sampler</h2>

<p align=justify>The <b>antialias sampler</b> sends a configurable number of rays for each pixel in the image. Ray directions are choose with a random generator. Result quality is far better than with the "super" sampler.</p>

<dir><img src="samp02.png" border="0" /></dir>

<ul type=square>
  <li class=code>AntialiasSampler(bounces, minWeight, samples)</li>
  <li class=code>AntialiasSampler(bounces, minWeight, samples, minDeviation)</li>
</ul>

<p align=justify>Actually, <i>samples</i> must be squared in order to know how many samples are taken for each pixel in the rendered image. XSight RT uses a technique known as <i>stratified sampling</i>, and it must distribute samples in a squared grid.</p>

<p align="justify">If you supply the <i>minDeviation</i> parameter, with each ray the sampler estimates the variance of the results and it stops sending ray as soon the estimation is lesser than <i>minDeviation</i>.</p>

<a name="adaptive"></a><h2>Adaptive sampler</h2>

<p align=justify>The <b>adaptive sampler</b> is a variation of the antialias sampler. A first special pass over the whole scene is performed, using only one ray by pixel. The number of bounces is limited to four, and the minimum weight is raised to 1/255. The image generated by this pass is applied a <i>high pass filter</i>, which helps identifying edges in the scene:</p>

<dir><img src="edgemap.png" border="0" /></dir>

<p align=justify>Note that the <a href="bmpsource.html#edgemap">edge map</a> marks not only the edges, but also sharp color transitions. For these points, the sampler will use the maximum number of samples. The rest of the image will be generated using the minimum number of samples.</p>

<p align=justify>To find the total number of pixels used by this sampler, move the mouse above the status bar when the generation is over:</p>

<dir><img src="spp.gif" border="0" /></dir>

<p align=justify>The adaptive sampler accepts these parameters:</p>

<ul type=square>
  <li class=code>AdaptiveSampler(bounces, minWeight, maxSamples)</li>
  <li class=code>AdaptiveSampler(bounces, minWeight, minSamples, maxSamples)</li>
</ul>

<p align=justify>When <i>minSamples</i> is not specified, the sampler asummes it's 3. You can set <i>minSamples</i> as low as 1.</p>


<h2><a name="focal"></a>Focal sampler</h2>

<p align=justify>The <b>focal sampler</b> adds another variation source to the algorithm used by the antialias sampler: this time, both the ray origin and target are changed at random. The effect of moving the origin is very subtle, but easy to understand. If we don't move the origin, there are no changes in visibility. On the contrary, when the camera move, visibility may change with each ray. This is also the reason why focal blur is not realistically emulated by post-processing. This image shows what happens:</p>

<dir><dir><img src="focal_def.gif" border="0"></dir></dir>

<p align=justify>The blue box blocks the visibility of the orange box. If the camera is located at the origin of ray <i>R1</i>, the intersection point between <i>R1</i> and the orange box is the leftmost visible point for that object. If we move the origin just a little, and then we trace another ray (<i>R2</i>),the new ray may reach previously hidden zones in the orange box. Note, however, that the size of the uncovered area is proportional to the distance from the camera position. Actually, the algorithm is more sophisticated: there must be no blurring for points located in the focal plane.</p>

<p align=justify>This is the effect of a focal sampler on our scene:</p>

<dir><img src="samp03.png" border="0" /></dir>

<p align=justify>The second ball shows now a slightly blurred border, while the first sphere still has a neat border.</p>

<p align=justify>A focal sampler is configured very similarly to the antialias sampler, but it needs an extra parameter: <i>aperture</i>. The bigger the aperture, the most noticeable effect. If you use a zero aperture, the focal sampler behaves exactly as the antialias sampler does... except for efficiency. If you don't want to use a non-zero aperture, that is, if you don't want focal blur, you should use an <a href="#antialias">antialias sampler</a>.</p>

<ul type=square>
  <li class=code>FocalSampler(bounces, minWeight, samples)</li>
  <li class=code>FocalSampler(bounces, minWeight, aperture, samples)</li>
  <li class=code>FocalSampler(bounces, minWeight, aperture, samples, minDeviation)</li>
</ul>

<a name="draft"></a><h2>Special samplers</h2>

<p align=justify>There are two more sampler classes: the <i>draft sampler</i> and the <i>sonar sampler</i>, but they cannot be instantiated from a scene script. These special samplers automatically replace the sampler specified in a script when the user selects a <a href="xsquality.html">render quality</a> other than <i>Optimal</i>.</p>

<p align=justify>The <b>draft</b> sampler doesn't trace reflected rays and use a simplified version for materials and lights. This sampler needs no further configuration. On the other hand, the <b>sonar</b> sampler probes distances from the camera to object in the scene, and maps these distance to colors. There is a <a href="optsform.html#sonar">Sonar Mode Options</a> pane in the Options dialog box for configuring this sampler.</p>

<a name="see"></a><h2>See also</h2>

<p>
  <a href="index.html">Home</a> |
  <a href="sillyref.html">Small Instantiation Language overview</a> |
  <a href="silly_scenes.html">Scenes</a> |
  <a href="silly_cameras.html">Cameras</a> |
  <a href="silly_lights.html">Lights</a> |
  <a href="silly_amb.html">Ambient lights</a> |
  <a href="silly_backs.html">Background</a> |
  <a href="silly_shapes.html">Predefined shapes</a> |
  <a href="silly_textures.html">Materials</a>
</p>

</div>

</BODY>
</HTML>
